#!/bin/sh
#
# fwmrc

# check there is a display running
test -z "$DISPLAY" && return 1

# check if arg 1 is an integer
intCheck() {
    test $1 -ne 0 2> /dev/null
    test $? -ne 2 || return 1
}

widCheck() {
    case "$1" in
        0x*) wattr "$1" ;;
        *)   return 1   ;;
    esac
}

name() {
    test $# -eq 0 && return 1
    for wid in $@; do
        lsw -a | grep -q "$wid" && {
            xprop -id "$wid" WM_CLASS | cut -d\" -f 2
            unset -v wid
        } || {
            unset -v wid
            return 1
        }
    done
}

class() {
    test $# -eq 0 && return 1
    for wid in $@; do
        lsw -a | grep -q "$wid" && {
            xprop -id "$wid" WM_CLASS | cut -d\" -f 4
            unset -v wid
        } || {
            unset -v wid
            return 1
        }
    done
}

process() {
    test $# -eq 0 && return 1
    for wid in $@; do
        lsw -a | grep -q "$wid" && {
            xprop -id "$wid" _NET_WM_PID | cut -d\  -f 3
            unset -v wid
        } || {
            printf '%s\n' "Please enter a valid window id." >&2
            unset -v wid
            return 1
        }
    done
}

# list windows on currently focused wid screen
listcurrent() {
    PFW="$(pfw 2> /dev/null || printf '%s\n' "0x00000001")"
    SCR="$(mattr i $PFW)"
    mattr si $(lsw) | grep "$SCR" | cut -d\  -f 1
}

wmenv() {
    fwmdir=${fwmdir:-/tmp/fwm}

    fsdir=${fsdir:-$fwmdir/fs}
    test ! -d "$fsdir" && mkdir -p "$fsdir"
    tiledir=${movedir:-$fwmdir/tile}
    test ! -d "$tiledir" && mkdir -p "$tiledir"
    movedir=${movedir:-$fwmdir/move}
    test ! -d "$movedir" && mkdir -p "$movedir"

    PFW="$(pfw 2> /dev/null || printf '%s\n' "0x00000001")"
    JUMP="$(grep "moveamount" ~/.cwmrc | cut -d\  -f 2)"
    BW="$(grep "borderwidth" ~/.cwmrc | cut -d\  -f 2)"
}

wmgaps() {
    PRI="$(lsm -p)"
    SEC="$(lsm | grep -v "$PRI")"
    TGAP="$(grep "gap" ~/.cwmrc | cut -d\  -f 2)"
    BGAP="$(grep "gap" ~/.cwmrc | cut -d\  -f 3)"
    LGAP="$(grep "gap" ~/.cwmrc | cut -d\  -f 4)"
    RGAP="$(grep "gap" ~/.cwmrc | cut -d\  -f 5)"
    IGAP="15"
}

wmcolours() {
    ACTIVE="$(grep "color activeborder" ~/.cwmrc | cut -d\" -f 2 | sed 's/#//')"
    URGENT="$(grep "color urgencyborder" ~/.cwmrc | cut -d\" -f 2 | sed 's/#//')"
    INACTIVE="$(grep "color inactiveborder" ~/.cwmrc | cut -d\" -f 2 | sed 's/#//')"
}
