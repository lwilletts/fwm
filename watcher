#!/bin/sh
#
# watcher

usage() {
    base=$(basename "$0")

    cat >&2 << EOF
Usage:
    $base
EOF

    test $# -eq 0 || exit "$1"
}

main() {
    autogroup="$HOME/.autogroup"

    wew | while read -r ev wid; do
        case "$ev" in
            CREATE)
                wattr o "$wid" || {
                    CLASS="$(atomx WM_CLASS "$wid")"
                    case "$CLASS" in
                        qutebrowser)
                            [ "$(wattr xywh "$wid")" = "50 50 800 600" ] && {
                                move center "$wid" "$(lsm -p)"
                            }
                            ;;
                        discord|obs)            ;;
                        steam|steam_app*)       ;;
                        *) wmv -a $(wmp) "$wid" ;;
                    esac

                    # autogroups
                    while read -r line; do
                        group="$(printf '%s\n' "$line" | cut -d\  -f 1)"
                        class="$(printf '%s\n' "$line" | cut -d\  -f 2)"

                        [ "$class" = "$CLASS" ] && group -a "$group" "$wid"
                    done < "$autogroup"

                }
                ;;
            FOCUS_IN|ENTER)
                pgrep cwm > /dev/null || {
                    wtf "$wid"
                }
                ;;
        esac
    done
}

main "$@"
