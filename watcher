#!/bin/sh
#
# watcher

nocomposite() {
    pgrep picom > /dev/null 2>&1 && pkill picom 2> /dev/null
    printf '%s\n' "$wid" >> "$nocomposite"
    move full "$wid" "$PRI"
}

event() {
    . fwmrc
    wmenv
    wmgaps

    nocomposite="$(mktemp)"

    wew | while read -r ev wid; do
        case "$ev" in
            CREATE)
                wattr o "$wid" || {
                    case "$(atomx WM_CLASS "$wid")" in
                        midair-win64-test.exe) nocomposite ;;
                    esac
                }
                ;;
            DESTROY)
                grep -q "$wid" "$nocomposite" > /dev/null 2>&1 && {
                    pgrep picom > /dev/null 2>&1 || picom &
                    sed -i "/$wid/d" "$nocomposite"
                }
                ;;
        esac
    done
}

event
